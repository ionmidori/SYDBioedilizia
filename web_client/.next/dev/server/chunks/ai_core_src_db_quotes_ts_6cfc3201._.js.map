{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/ai_core/src/db/quotes.ts"],"sourcesContent":["\r\nimport { db } from '../firebase-admin';\r\nimport type { Firestore } from 'firebase-admin/firestore';\r\n\r\n/**\r\n * Interface corresponding to the data structure collected for the quote\r\n */\r\nexport interface QuoteDraftData {\r\n    // Technical Data (The Convergence Protocol)\r\n    logistics?: {\r\n        floor?: string;\r\n        elevator?: boolean;\r\n        yearOfConstruction?: string;\r\n        ceilingHeight?: string;\r\n    };\r\n    scopeOfWork?: {\r\n        demolitions?: boolean;\r\n        electrical?: string;\r\n        plumbing?: string;\r\n        fixtures?: string;\r\n    };\r\n    quantities?: {\r\n        sqm?: number;\r\n        points?: number;\r\n    };\r\n    // Context\r\n    roomType?: string;\r\n    style?: string;\r\n    // Generated Visuals\r\n    renderUrl?: string;\r\n\r\n    // Metadata\r\n    status: 'draft' | 'pending_review' | 'processed';\r\n    createdAt: string;\r\n    updatedAt: string;\r\n    schemaVersion: number;\r\n}\r\n\r\n/**\r\n * Saves a new quote draft to the 'quotes' collection in Firestore.\r\n * \r\n * @param userId - The ID of the user (or session ID if anonymous)\r\n * @param imageUrl - Optional URL of the reference image or generated render\r\n * @param aiData - The structured data collected by the Technical Surveyor (Mode B)\r\n * @returns The ID of the created document\r\n */\r\nexport async function saveQuoteDraft(\r\n    userId: string,\r\n    imageUrl: string | null | undefined,\r\n    aiData: any\r\n): Promise<string> {\r\n    try {\r\n        const firestore: Firestore = db();\r\n\r\n        // Sanitize and structure the data\r\n        const quoteData: QuoteDraftData = {\r\n            ...aiData,\r\n            clientId: userId, // Mapping userId to clientId or storing it separately\r\n            renderUrl: imageUrl || aiData.renderUrl || null,\r\n            status: 'draft',\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString(),\r\n            schemaVersion: 1\r\n        };\r\n\r\n        // Add to 'quotes' collection\r\n        const docRef = await firestore.collection('quotes').add(quoteData);\r\n\r\n        console.log(`[QuoteSystem] Draft saved with ID: ${docRef.id} for User: ${userId}`);\r\n\r\n        return docRef.id;\r\n\r\n    } catch (error) {\r\n        console.error('[QuoteSystem] Error saving quote draft:', error);\r\n        throw new Error(`Failed to save quote draft: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;;;;;AA6CO,eAAe,eAClB,MAAc,EACd,QAAmC,EACnC,MAAW;IAEX,IAAI;QACA,MAAM,YAAuB,IAAA,2IAAE;QAE/B,kCAAkC;QAClC,MAAM,YAA4B;YAC9B,GAAG,MAAM;YACT,UAAU;YACV,WAAW,YAAY,OAAO,SAAS,IAAI;YAC3C,QAAQ;YACR,WAAW,IAAI,OAAO,WAAW;YACjC,WAAW,IAAI,OAAO,WAAW;YACjC,eAAe;QACnB;QAEA,6BAA6B;QAC7B,MAAM,SAAS,MAAM,UAAU,UAAU,CAAC,UAAU,GAAG,CAAC;QAExD,QAAQ,GAAG,CAAC,CAAC,mCAAmC,EAAE,OAAO,EAAE,CAAC,WAAW,EAAE,QAAQ;QAEjF,OAAO,OAAO,EAAE;IAEpB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,2CAA2C;QACzD,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;IAC7G;AACJ"}}]
}