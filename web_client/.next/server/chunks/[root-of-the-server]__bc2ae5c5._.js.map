{"version":3,"sources":["../../../../node_modules/%40vercel/oidc/dist/token-error.js","../../../../ai_core/src/firebase-admin.ts","../../../../web_client/lib/firebase-admin.ts","../../../../web_client/lib/rate-limit.ts"],"sourcesContent":["\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n","import { initializeApp, cert, getApps, App } from 'firebase-admin/app';\r\nimport { getFirestore, Firestore } from 'firebase-admin/firestore';\r\nimport { getStorage, Storage } from 'firebase-admin/storage';\r\n\r\n/**\r\n * Firebase Admin SDK initialization for server-side operations\r\n * Singleton pattern ensures single instance across serverless invocations\r\n * ALWAYS loads from firebase-service-account.json for reliability\r\n */\r\n\r\nlet firebaseApp: App | undefined;\r\nlet firestoreInstance: Firestore | undefined;\r\nlet storageInstance: Storage | undefined;\r\n\r\n/**\r\n * ✅ CRITICAL FIX #2: Validate Firebase credentials format\r\n * Prevents security risks from malformed credentials\r\n */\r\n/**\r\n * ✅ CRITICAL FIX #2: Sanitize and Validate Firebase Private Key\r\n * Prevents security risks from malformed credentials and ensures correct format.\r\n * Returns the sanitized private key.\r\n */\r\nfunction sanitizeAndValidatePrivateKey(privateKey: string): string {\r\n    if (!privateKey) {\r\n        throw new Error('[Firebase] Private key is missing');\r\n    }\r\n\r\n    // 1. Sanitize: Handle both escaped (\\n) and unescaped newlines\r\n    let sanitizedKey = privateKey.replace(/\\\\n/g, '\\n');\r\n\r\n    // 2. Sanitize: Remove wrapping quotes if present (common env var issue)\r\n    if (sanitizedKey.startsWith('\"') && sanitizedKey.endsWith('\"')) {\r\n        sanitizedKey = sanitizedKey.slice(1, -1);\r\n    }\r\n    if (sanitizedKey.startsWith(\"'\") && sanitizedKey.endsWith(\"'\")) {\r\n        sanitizedKey = sanitizedKey.slice(1, -1);\r\n    }\r\n\r\n    // 3. Validation: Check for standard PEM format markers\r\n    if (!sanitizedKey.includes('BEGIN PRIVATE KEY') || !sanitizedKey.includes('END PRIVATE KEY')) {\r\n        throw new Error('[Firebase] Invalid private key format - must be a valid RSA private key (PEM format)');\r\n    }\r\n\r\n    // 4. Validation: content check\r\n    const keyContent = sanitizedKey.split('BEGIN PRIVATE KEY')[1]?.split('END PRIVATE KEY')[0];\r\n    if (!keyContent || keyContent.trim().length < 100) {\r\n        throw new Error('[Firebase] Private key appears to be truncated or empty');\r\n    }\r\n\r\n    // 5. Re-verify newlines for PEM validity\r\n    if (!sanitizedKey.includes('\\n')) {\r\n        throw new Error('[Firebase] Private key invalid: missing newlines after sanitization');\r\n    }\r\n\r\n    return sanitizedKey;\r\n}\r\n\r\n/**\r\n * Validates other credential fields\r\n */\r\nfunction validateServiceAccount(clientEmail: string, projectId: string): void {\r\n    // Validate email format\r\n    if (!clientEmail || !clientEmail.includes('@') || !clientEmail.endsWith('.gserviceaccount.com')) {\r\n        throw new Error(`[Firebase] Invalid service account email: ${clientEmail} - must end with .gserviceaccount.com`);\r\n    }\r\n\r\n    // Validate project ID format\r\n    if (!projectId || projectId.length < 6 || !/^[a-z0-9-]+$/.test(projectId)) {\r\n        throw new Error(`[Firebase] Invalid project ID: ${projectId} - must contain only lowercase letters, numbers, and hyphens`);\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize Firebase Admin SDK\r\n * Loads from environment variables (Vercel-compatible) or falls back to JSON file\r\n */\r\nfunction initializeFirebase(): App {\r\n    if (getApps().length === 0) {\r\n        console.log('[Firebase] Initializing Firebase Admin SDK...');\r\n\r\n        try {\r\n            // Try environment variables first (Vercel-compatible)\r\n            // Try environment variables first (Vercel-compatible)\r\n            const rawPrivateKey = process.env.FIREBASE_PRIVATE_KEY;\r\n\r\n            if (rawPrivateKey && process.env.FIREBASE_CLIENT_EMAIL && process.env.FIREBASE_PROJECT_ID) {\r\n                console.log('[Firebase] Loading credentials from environment variables');\r\n\r\n                // ✅ CRITICAL FIX #2: Sanitize & Validate\r\n                const privateKey = sanitizeAndValidatePrivateKey(rawPrivateKey);\r\n\r\n                validateServiceAccount(\r\n                    process.env.FIREBASE_CLIENT_EMAIL,\r\n                    process.env.FIREBASE_PROJECT_ID\r\n                );\r\n\r\n                firebaseApp = initializeApp({\r\n                    credential: cert({\r\n                        projectId: process.env.FIREBASE_PROJECT_ID,\r\n                        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n                        privateKey: privateKey,\r\n                    }),\r\n                    storageBucket: `${process.env.FIREBASE_PROJECT_ID}.firebasestorage.app`,\r\n                });\r\n\r\n                console.log('[Firebase] ✅ Successfully initialized from environment variables');\r\n\r\n                return firebaseApp;\r\n            }\r\n\r\n            // Fallback to JSON file (local development)\r\n            const fs = require('fs');\r\n            const path = require('path');\r\n\r\n            const serviceAccountPath = path.join(process.cwd(), 'firebase-service-account.json');\r\n\r\n            console.log('[Firebase] Loading credentials from:', serviceAccountPath);\r\n\r\n            if (!fs.existsSync(serviceAccountPath)) {\r\n                throw new Error(`Firebase service account file not found at: ${serviceAccountPath}. Please ensure firebase-service-account.json exists in the project root OR set environment variables.`);\r\n            }\r\n\r\n            const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));\r\n\r\n            // ✅ CRITICAL FIX #2: Validate JSON file credentials\r\n            const privateKey = sanitizeAndValidatePrivateKey(serviceAccount.private_key);\r\n\r\n            validateServiceAccount(\r\n                serviceAccount.client_email,\r\n                serviceAccount.project_id\r\n            );\r\n\r\n            firebaseApp = initializeApp({\r\n                credential: cert({\r\n                    ...serviceAccount,\r\n                    private_key: privateKey // Use sanitized key\r\n                }),\r\n                storageBucket: serviceAccount.project_id + '.firebasestorage.app',\r\n            });\r\n\r\n            console.log('[Firebase] ✅ Successfully initialized from JSON file');\r\n\r\n            return firebaseApp!; // Assert not null since we just initialized it\r\n        } catch (error) {\r\n            console.error('[Firebase] ❌ Initialization FAILED:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    return getApps()[0];\r\n}\r\n\r\n/**\r\n * Get Firestore instance (singleton)\r\n * CRITICAL FIX: Removed settings() call to prevent re-initialization error\r\n */\r\nexport function getFirestoreDb(): Firestore {\r\n    if (!firestoreInstance) {\r\n        const app = initializeFirebase();\r\n        firestoreInstance = getFirestore(app);\r\n        // REMOVED: settings() call - was causing \"already initialized\" error\r\n    }\r\n\r\n    return firestoreInstance;\r\n}\r\n\r\n/**\r\n * Get Firebase Storage instance (singleton)\r\n */\r\nexport function getFirebaseStorage(): Storage {\r\n    if (!storageInstance) {\r\n        const app = initializeFirebase();\r\n        storageInstance = getStorage(app);\r\n    }\r\n\r\n    return storageInstance;\r\n}\r\n\r\n// Export convenient aliases\r\nexport const db = getFirestoreDb;\r\nexport const storage = getFirebaseStorage;\r\n","import { initializeApp, cert, getApps, App } from 'firebase-admin/app';\r\nimport { getFirestore, Firestore } from 'firebase-admin/firestore';\r\nimport { getStorage, Storage } from 'firebase-admin/storage';\r\n\r\n/**\r\n * Firebase Admin SDK initialization for server-side operations\r\n * Singleton pattern ensures single instance across serverless invocations\r\n * ALWAYS loads from firebase-service-account.json for reliability\r\n */\r\n\r\nlet firebaseApp: App | undefined;\r\nlet firestoreInstance: Firestore | undefined;\r\nlet storageInstance: Storage | undefined;\r\n\r\n/**\r\n * ✅ CRITICAL FIX #2: Validate Firebase credentials format\r\n * Prevents security risks from malformed credentials\r\n */\r\n/**\r\n * ✅ CRITICAL FIX #2: Sanitize and Validate Firebase Private Key\r\n * Prevents security risks from malformed credentials and ensures correct format.\r\n * Returns the sanitized private key.\r\n */\r\nfunction sanitizeAndValidatePrivateKey(privateKey: string): string {\r\n    if (!privateKey) {\r\n        throw new Error('[Firebase] Private key is missing');\r\n    }\r\n\r\n    // 1. Sanitize: Handle both escaped (\\n) and unescaped newlines\r\n    let sanitizedKey = privateKey.replace(/\\\\n/g, '\\n');\r\n\r\n    // 2. Sanitize: Remove wrapping quotes if present (common env var issue)\r\n    if (sanitizedKey.startsWith('\"') && sanitizedKey.endsWith('\"')) {\r\n        sanitizedKey = sanitizedKey.slice(1, -1);\r\n    }\r\n    if (sanitizedKey.startsWith(\"'\") && sanitizedKey.endsWith(\"'\")) {\r\n        sanitizedKey = sanitizedKey.slice(1, -1);\r\n    }\r\n\r\n    // 3. Validation: Check for standard PEM format markers\r\n    if (!sanitizedKey.includes('BEGIN PRIVATE KEY') || !sanitizedKey.includes('END PRIVATE KEY')) {\r\n        throw new Error('[Firebase] Invalid private key format - must be a valid RSA private key (PEM format)');\r\n    }\r\n\r\n    // 4. Validation: content check\r\n    const keyContent = sanitizedKey.split('BEGIN PRIVATE KEY')[1]?.split('END PRIVATE KEY')[0];\r\n    if (!keyContent || keyContent.trim().length < 100) {\r\n        throw new Error('[Firebase] Private key appears to be truncated or empty');\r\n    }\r\n\r\n    // 5. Re-verify newlines for PEM validity\r\n    if (!sanitizedKey.includes('\\n')) {\r\n        throw new Error('[Firebase] Private key invalid: missing newlines after sanitization');\r\n    }\r\n\r\n    return sanitizedKey;\r\n}\r\n\r\n/**\r\n * Validates other credential fields\r\n */\r\nfunction validateServiceAccount(clientEmail: string, projectId: string): void {\r\n    // Validate email format\r\n    if (!clientEmail || !clientEmail.includes('@') || !clientEmail.endsWith('.gserviceaccount.com')) {\r\n        throw new Error(`[Firebase] Invalid service account email: ${clientEmail} - must end with .gserviceaccount.com`);\r\n    }\r\n\r\n    // Validate project ID format\r\n    if (!projectId || projectId.length < 6 || !/^[a-z0-9-]+$/.test(projectId)) {\r\n        throw new Error(`[Firebase] Invalid project ID: ${projectId} - must contain only lowercase letters, numbers, and hyphens`);\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize Firebase Admin SDK\r\n * Loads from environment variables (Vercel-compatible) or falls back to JSON file\r\n */\r\nfunction initializeFirebase(): App {\r\n    if (getApps().length === 0) {\r\n        console.log('[Firebase] Initializing Firebase Admin SDK...');\r\n\r\n        try {\r\n            // Try environment variables first (Vercel-compatible)\r\n            // Try environment variables first (Vercel-compatible)\r\n            const rawPrivateKey = process.env.FIREBASE_PRIVATE_KEY;\r\n\r\n            if (rawPrivateKey && process.env.FIREBASE_CLIENT_EMAIL && process.env.FIREBASE_PROJECT_ID) {\r\n                console.log('[Firebase] Loading credentials from environment variables');\r\n\r\n                // ✅ CRITICAL FIX #2: Sanitize & Validate\r\n                const privateKey = sanitizeAndValidatePrivateKey(rawPrivateKey);\r\n\r\n                validateServiceAccount(\r\n                    process.env.FIREBASE_CLIENT_EMAIL,\r\n                    process.env.FIREBASE_PROJECT_ID\r\n                );\r\n\r\n                firebaseApp = initializeApp({\r\n                    credential: cert({\r\n                        projectId: process.env.FIREBASE_PROJECT_ID,\r\n                        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n                        privateKey: privateKey,\r\n                    }),\r\n                    storageBucket: `${process.env.FIREBASE_PROJECT_ID}.firebasestorage.app`,\r\n                });\r\n\r\n                console.log('[Firebase] ✅ Successfully initialized from environment variables');\r\n\r\n                return firebaseApp;\r\n            }\r\n\r\n            // Fallback to JSON file (local development)\r\n            const fs = require('fs');\r\n            const path = require('path');\r\n\r\n            const serviceAccountPath = path.join(process.cwd(), 'firebase-service-account.json');\r\n\r\n            console.log('[Firebase] Loading credentials from:', serviceAccountPath);\r\n\r\n            if (!fs.existsSync(serviceAccountPath)) {\r\n                throw new Error(`Firebase service account file not found at: ${serviceAccountPath}. Please ensure firebase-service-account.json exists in the project root OR set environment variables.`);\r\n            }\r\n\r\n            const serviceAccount = JSON.parse(fs.readFileSync(serviceAccountPath, 'utf8'));\r\n\r\n            // ✅ CRITICAL FIX #2: Validate JSON file credentials\r\n            const privateKey = sanitizeAndValidatePrivateKey(serviceAccount.private_key);\r\n\r\n            validateServiceAccount(\r\n                serviceAccount.client_email,\r\n                serviceAccount.project_id\r\n            );\r\n\r\n            firebaseApp = initializeApp({\r\n                credential: cert({\r\n                    ...serviceAccount,\r\n                    private_key: privateKey // Use sanitized key\r\n                }),\r\n                storageBucket: serviceAccount.project_id + '.firebasestorage.app',\r\n            });\r\n\r\n            console.log('[Firebase] ✅ Successfully initialized from JSON file');\r\n\r\n            return firebaseApp!; // Assert not null since we just initialized it\r\n        } catch (error) {\r\n            console.error('[Firebase] ❌ Initialization FAILED:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    return getApps()[0];\r\n}\r\n\r\n/**\r\n * Get Firestore instance (singleton)\r\n * CRITICAL FIX: Removed settings() call to prevent re-initialization error\r\n */\r\nexport function getFirestoreDb(): Firestore {\r\n    if (!firestoreInstance) {\r\n        const app = initializeFirebase();\r\n        firestoreInstance = getFirestore(app);\r\n        // REMOVED: settings() call - was causing \"already initialized\" error\r\n    }\r\n\r\n    return firestoreInstance;\r\n}\r\n\r\n/**\r\n * Get Firebase Storage instance (singleton)\r\n */\r\nexport function getFirebaseStorage(): Storage {\r\n    if (!storageInstance) {\r\n        const app = initializeFirebase();\r\n        storageInstance = getStorage(app);\r\n    }\r\n\r\n    return storageInstance;\r\n}\r\n\r\n// Export convenient aliases\r\nexport const db = getFirestoreDb;\r\nexport const storage = getFirebaseStorage;\r\n","/**\r\n * Hybrid Rate Limiter - Firestore + In-Memory Cache\r\n * \r\n * Architecture:\r\n * - Level 1: In-memory cache (fast, 10s TTL)\r\n * - Level 2: Firestore transaction (authoritative, distributed)\r\n * \r\n * Benefits:\r\n * - Low latency for repeated requests (~0ms cache hit)\r\n * - Distributed protection against abuse\r\n * - Works across serverless instances\r\n */\r\n\r\nimport { db as getDb } from '@/lib/firebase-admin';\r\nimport { Timestamp } from 'firebase-admin/firestore';\r\n\r\n// Get Firestore instance\r\nconst db = getDb();\r\n\r\n// Configuration\r\nconst WINDOW_MS = 60000; // 1 minute sliding window\r\nconst MAX_REQUESTS = 20; // 20 requests per minute\r\nconst CACHE_TTL_MS = 10000; // 10 seconds cache\r\n\r\n// Types\r\ninterface RateLimitData {\r\n    count: number;\r\n    windowStart: number;\r\n    lastRequest: number;\r\n}\r\n\r\ninterface CachedRateLimit {\r\n    allowed: boolean;\r\n    remaining: number;\r\n    resetAt: Date;\r\n    timestamp: number;\r\n}\r\n\r\n// In-memory cache for fast lookups\r\nconst cache = new Map<string, CachedRateLimit>();\r\n\r\n// ✅ BUG FIX #1: Proper interval cleanup to prevent memory leak\r\nlet cleanupInterval: NodeJS.Timeout | null = null;\r\n\r\nfunction initializeCleanup() {\r\n    if (cleanupInterval) return; // Already initialized\r\n\r\n    cleanupInterval = setInterval(() => {\r\n        const now = Date.now();\r\n        for (const [key, value] of cache.entries()) {\r\n            if (now - value.timestamp > CACHE_TTL_MS) {\r\n                cache.delete(key);\r\n            }\r\n        }\r\n    }, 30000); // Clean every 30 seconds\r\n\r\n    console.log('[RateLimit] Cache cleanup interval initialized');\r\n}\r\n\r\n// Initialize cleanup on module load\r\ninitializeCleanup();\r\n\r\n// Cleanup on process termination (important for serverless)\r\nprocess.on('beforeExit', () => {\r\n    if (cleanupInterval) {\r\n        clearInterval(cleanupInterval);\r\n        cleanupInterval = null;\r\n        console.log('[RateLimit] Cache cleanup interval cleared');\r\n    }\r\n});\r\n\r\n/**\r\n * Check if IP is within rate limits\r\n * Uses Firestore as authoritative source (cache disabled for accuracy)\r\n */\r\nexport async function checkRateLimit(ip: string): Promise<{\r\n    allowed: boolean;\r\n    remaining: number;\r\n    resetAt: Date;\r\n}> {\r\n    // Always check Firestore for accurate counting\r\n    // NOTE: Cache was causing issues with window resets\r\n    console.log('[RateLimit] Checking Firestore for IP:', ip);\r\n    const result = await checkFirestoreRateLimit(ip);\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * Firestore-based rate limiting with sliding window\r\n */\r\nasync function checkFirestoreRateLimit(ip: string): Promise<{\r\n    allowed: boolean;\r\n    remaining: number;\r\n    resetAt: Date;\r\n}> {\r\n    const rateLimitRef = db.collection('rate_limits').doc(ip);\r\n\r\n    const result = await db.runTransaction(async (transaction) => {\r\n        const doc = await transaction.get(rateLimitRef);\r\n        const now = Date.now();\r\n\r\n        if (!doc.exists) {\r\n            // First request from this IP\r\n            transaction.set(rateLimitRef, {\r\n                count: 1,\r\n                windowStart: Timestamp.fromMillis(now),\r\n                lastRequest: Timestamp.fromMillis(now),\r\n            });\r\n\r\n            return {\r\n                allowed: true,\r\n                remaining: MAX_REQUESTS - 1,\r\n                resetAt: now + WINDOW_MS,\r\n            };\r\n        }\r\n\r\n        const data = doc.data() as any; // Firestore returns Timestamp objects\r\n        const windowStart = data.windowStart.toMillis();\r\n        const timeSinceWindowStart = now - windowStart;\r\n\r\n        // Check if we need a new window\r\n        if (timeSinceWindowStart >= WINDOW_MS) {\r\n            // Start new window\r\n            transaction.update(rateLimitRef, {\r\n                count: 1,\r\n                windowStart: Timestamp.fromMillis(now),\r\n                lastRequest: Timestamp.fromMillis(now),\r\n            });\r\n\r\n            return {\r\n                allowed: true,\r\n                remaining: MAX_REQUESTS - 1,\r\n                resetAt: now + WINDOW_MS,\r\n            };\r\n        }\r\n\r\n        // Within existing window\r\n        if (data.count >= MAX_REQUESTS) {\r\n            // Rate limit exceeded\r\n            return {\r\n                allowed: false,\r\n                remaining: 0,\r\n                resetAt: windowStart + WINDOW_MS,\r\n            };\r\n        }\r\n\r\n        // Increment counter\r\n        transaction.update(rateLimitRef, {\r\n            count: data.count + 1,\r\n            lastRequest: Timestamp.fromMillis(now),\r\n        });\r\n\r\n        return {\r\n            allowed: true,\r\n            remaining: MAX_REQUESTS - (data.count + 1),\r\n            resetAt: windowStart + WINDOW_MS,\r\n        };\r\n    });\r\n\r\n    return {\r\n        ...result,\r\n        resetAt: new Date(result.resetAt),\r\n    };\r\n}\r\n\r\n/**\r\n * Cleanup expired rate limit records (optional maintenance)\r\n * Call this from a cron job or scheduled function\r\n */\r\nexport async function cleanupExpiredRateLimits(): Promise<number> {\r\n    const twoHoursAgo = Timestamp.fromMillis(Date.now() - 7200000);\r\n\r\n    const snapshot = await db.collection('rate_limits')\r\n        .where('lastRequest', '<', twoHoursAgo)\r\n        .limit(500)\r\n        .get();\r\n\r\n    if (snapshot.empty) {\r\n        return 0;\r\n    }\r\n\r\n    const batch = db.batch();\r\n    snapshot.docs.forEach(doc => batch.delete(doc.ref));\r\n\r\n    await batch.commit();\r\n\r\n    console.log(`[RateLimit Cleanup] Deleted ${snapshot.size} expired records`);\r\n    return snapshot.size;\r\n}\r\n\r\n/**\r\n * Get current rate limit stats for an IP (for debugging)\r\n */\r\nexport async function getRateLimitStats(ip: string): Promise<RateLimitData | null> {\r\n    const doc = await db.collection('rate_limits').doc(ip).get();\r\n    if (!doc.exists) return null;\r\n\r\n    const data = doc.data() as any;\r\n    return {\r\n        count: data.count,\r\n        windowStart: data.windowStart.toMillis(),\r\n        lastRequest: data.lastRequest.toMillis(),\r\n    };\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}